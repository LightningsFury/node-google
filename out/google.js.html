<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: google.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: google.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>var request = require("request");
var cheerio = require("cheerio");
var querystring = require("querystring");
var util = require("util");

var linkSel = "h3.r a";
var descSel = "div.s";
var itemSel = "div.g";
var nextSel = "td.b a span";

var URL =
  "%s://www.google.%s/search?hl=%s&amp;q=%s&amp;start=%s&amp;sa=N&amp;num=%s&amp;ie=UTF-8&amp;oe=UTF-8&amp;gws_rd=ssl";

var nextTextErrorMsg =
  "Translate `google.nextText` option to selected language to detect next results link.";
var protocolErrorMsg =
  "Protocol `google.protocol` needs to be set to either 'http' or 'https', please use a valid protocol. Setting the protocol to 'https'.";

// start parameter is optional
/**
 * googles something
 * @param  {string} query
 * @param  {int} start
 * @param  {func} callback
 */
function google(query, start, callback) {
  var startIndex = 0;
  if (typeof callback === "undefined") {
    callback = start;
  } else {
    startIndex = start;
  }
  /* cSpell:disable */
  iGoogle(query, startIndex, callback);
  /* cSpell:enable */
}

google.resultsPerPage = 10;
google.tld = "com";
google.lang = "en";
google.requestOptions = {};
google.nextText = "Next";
google.protocol = "https";

/**
 * @param  {string} query
 * @param  {number} start
 * @param  {function} callback
 */
var iGoogle = function(query, start, callback) {
  if (google.resultsPerPage > 100) google.resultsPerPage = 100; // Google won't allow greater than 100 anyway
  if (google.lang !== "en" &amp;&amp; google.nextText === "Next")
    console.warn(nextTextErrorMsg);
  if (google.protocol !== "http" &amp;&amp; google.protocol !== "https") {
    google.protocol = "https";
    console.warn(protocolErrorMsg);
  }

  // timestamp is optional. splice in if set
  if (google.timeSpan) {
    URL =
      URL.indexOf("tbs=qdr:") >= 0
        ? URL.replace(/tbs=qdr:[snhdwmy]\d*/, "tbs=qdr:" + google.timeSpan)
        : URL.concat("&amp;tbs=qdr:", google.timeSpan);
  }
  var newUrl = util.format(
    URL,
    google.protocol,
    google.tld,
    google.lang,
    querystring.escape(query),
    start,
    google.resultsPerPage
  );
  var requestOptions = {
    url: newUrl,
    method: "GET"
  };

  for (var k in google.requestOptions) {
    requestOptions[k] = google.requestOptions[k];
  }

  request(requestOptions, function(err, resp, body) {
    if (err == null &amp;&amp; resp.statusCode === 200) {
      var $ = cheerio.load(body);
      var res = {
        url: newUrl,
        query: query,
        start: start,
        links: [],
        $: $,
        body: body
      };

      $(itemSel).each(function(i, elem) {
        var linkElem = $(elem).find(linkSel);
        var descElem = $(elem).find(descSel);
        var item = {
          title: $(linkElem)
            .first()
            .text(),
          link: null,
          description: null,
          href: null
        };
        var qsObj = querystring.parse($(linkElem).attr("href"));

        if (qsObj["/url?q"]) {
          item.link = qsObj["/url?q"];
          item.href = item.link;
        }

        $(descElem)
          .find("div")
          .remove();
        item.description = $(descElem).text();

        res.links.push(item);
      });

      if (
        $(nextSel)
          .last()
          .text() === google.nextText
      ) {
        res.next = function() {
          iGoogle(query, start + google.resultsPerPage, callback);
        };
      }

      callback(null, res);
    } else {
      callback(
        new Error(
          "Error on response" +
            (resp ? " (" + resp.statusCode + ")" : "") +
            ":" +
            err +
            " : " +
            body
        ),
        null,
        null
      );
    }
  });
};

module.exports = google;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#google">google</a></li><li><a href="global.html#iGoogle">iGoogle</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Sun Nov 18 2018 14:49:04 GMT+0000 (GMT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
